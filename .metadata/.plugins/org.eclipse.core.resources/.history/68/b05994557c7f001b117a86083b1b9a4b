package protocol3.tasks;

import java.util.TimerTask;

import protocol3.Main;
import protocol3.backend.LagProcessor;
import protocol3.backend.Scheduler;
import protocol3.commands.VoteMute;

// Tps processor
public class OnTick extends TimerTask
{

	public static int lowTpsCounter = 0;
	public static int timeTillReset = 1200;

	@Override
	public void run()
	{
		VoteMute.processVoteCooldowns();

		if (LagProcessor.getTPS() < 9 && !Main.alreadyRestarting)
		{
			lowTpsCounter++;
		}

		if (lowTpsCounter == 100)
		{
			Main.alreadyRestarting = true;
			Main.cleanRestart();
		}

		timeTillReset--;

		if (timeTillReset == 0)
		{
			lowTpsCounter = 0;
			timeTillReset = 1200;
		}

		Scheduler.setLastTaskId("tickTasks");
	}
}